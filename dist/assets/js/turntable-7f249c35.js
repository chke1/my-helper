import{n as y}from"./index-62cef2e0.js";import{c as K,j as O,_ as Q,v as V,x as Z}from"./main/chunk-vue-32374f64.js";import"./main/chunk-element-plus-b8cc1db0.js";import"./main/chunk-lodash-es-21c98b27.js";import"./main/chunk-vue-router-c3f0a4ff.js";import"./main/chunk-fingerprintjs-cb838e3e.js";import"./main/chunk-sortablejs-be94e56d.js";const tt={width:"300",height:"300",id:"turntableID"},at={__name:"turntable",props:{sectorData:{type:Array,default:()=>[]},id:{type:[String,Number],default:""}},emits:["on-start"],setup(M,{expose:R,emit:S}){const T=M;let l=T.sectorData,c={},t={};const _=window.devicePixelRatio,a=Math.PI/180,w=150,P=150,g=130,m=360/l.length,D=15,L=Math.sin(a*m/2)*(g-D)*2;let d=0,h=null,u=0;const k=Math.ceil((0-m/2-90)*a*100)/100,B=Math.ceil((m-m/2-90)*a*100)/100,E=window.requestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};K(()=>{if(T.id){const{range:e}=l.find(r=>r.id==T.id)||{},i=y(e[0],e[1]),n=y(3*360,6*360),s=n%360;let o=0;return s>=i?o=(n-(s-i))%360+n:o=(n+(i-s))%360+n,o}else return 1});const W=e=>new Promise((i,n)=>{var s=new Image;s.src=e,s.onload=function(){i(s)}}),Y=e=>Math.sin(a*m/2)*(e-D)*2,$=(e,i)=>{const n=e.split(""),s=[];let o="",r=1,f=L;for(let p=0;p<n.length;p++){const{width:x}=t.measureText(o);x>=f-2*D&&(s.push(o),o="",f=Y(g-i*r),r++),o+=n[p]}return s.push(o),s},j=(e=500)=>new Promise((i,n)=>{setTimeout(()=>{i()},e)}),z=()=>{if(!h){const e=360-d%360,i=l.find(n=>n.range[0]<e&&n.range[1]>=e);S("on-change",i,e)}},I=e=>{t.clearRect(0,0,t.width,t.height),t.save(),t.beginPath(),t.strokeStyle="#6e3f00",t.lineWidth="10",t.arc(w,P,g,a*0,a*360),t.closePath(),t.stroke(),t.restore(),l.forEach((n,s)=>{t.save(),t.beginPath(),t.moveTo(w,P),t.translate(w,P),t.rotate(Math.round(a*(m*s+d)*100)/100),t.arc(0,0,g,k,B),t.closePath(),t.fillStyle=n.color,t.fill();const o=14,r=2,f=-(g-o-D);t.fillStyle="#fff",t.font=`${o}px Georgia`,t.textAlign="center";const p=$(n.text,o);p.forEach((U,J)=>{t.fillText(U,0,f+J*(o+r))});const x=32,q=(p.length-1)*(o+r),H=-(g-x-o-q);t.drawImage(n.image,-x/2,H,x,x),t.restore()}),t.save(),t.beginPath(),t.fillStyle="#FF0000",t.arc(w,P,g/4.5,a*0,a*360),t.closePath(),e&&e(),t.fill();const i=14;t.fillStyle="#fff",t.font=`${i}px Georgia`,t.textAlign="center",t.fillText("抽奖",w,P+i/2),t.beginPath(),t.fillStyle="#FF0000",t.moveTo(140,125),t.lineTo(150,100),t.lineTo(160,125),t.closePath(),t.fill(),t.restore()},C=()=>{F()},v=()=>{window.cancelAnimationFrame(h),clearTimeout(h),h=null,z(),d=0,u=0},b=()=>{u-=.2},A=()=>{u+=.2},F=()=>{if(h)return;N();let e=!1;const i=y(3*360,6*360),n=async()=>{await j(100),d>=i&&(e=!0),e?b():A(),u>=0?n():v()};n()},G=()=>{const{range:e}=l.find(r=>r.id==T.id)||{},i=y(e[0],e[1]),n=y(3*360,6*360),s=n%360;let o=0;s>=i?o=(n-(s-i))%360+n:o=(n+(i-s))%360+n,N()},X=async()=>{c=document.getElementById("turntableID"),t=c.getContext("2d");const{width:e,height:i}=c;c.style.width=`${e}px`,c.style.height=`${i}px`,c.width=e*_,c.height=i*_;let n=await Promise.all(l.map(s=>W(s.url)));l=l.map((s,o)=>({...s,image:n[o],range:[o*m,(o+1)*m]})),c.onclick=function(s){const o=c.getBoundingClientRect(),r=s.clientX-o.left,f=s.clientY-o.top;I(()=>{t.isPointInPath(r,f)&&S("on-start",r,f)})},I()},N=()=>{d=d+u,I(),d>1e3?u-=.1:u+=.1,h=E(N)};return O(()=>{X()}),Q(()=>{v()}),R({start:C,stop:v,down:b,up:A,random:F,lottery:G}),(e,i)=>(V(),Z("canvas",tt))}};export{at as default};
