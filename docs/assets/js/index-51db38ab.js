import{T as A}from"./table-group-0cb47a00.js";import{_ as E,c as O,y as G}from"./index-4158e2fb.js";import T from"./render-list-10e441f6.js";import{E as H}from"./main/chunk-element-plus-b8cc1db0.js";import{d as I,a as n,j as P,ag as p,v as c,P as u,Q as f,y as m,W as y,T as h,V as U,x as B,F as Q,a8 as W}from"./main/chunk-vue-32374f64.js";import"./main/chunk-vue-router-c3f0a4ff.js";import"./main/chunk-fingerprintjs-cb838e3e.js";import"./main/chunk-sortablejs-be94e56d.js";import"./main/chunk-lodash-es-21c98b27.js";import"./main/chunk-vuedraggable-67b28d1d.js";const q={class:"table-group"},z={class:"dir-tree-box",id:"dirTreeBox"},J={class:"table-group__content"},K={class:"name is-title"},X={key:0,class:"list"},Y=I({name:"feature.directory-picker"}),Z=Object.assign(Y,{setup($){const v=O(),k=["jpg","png","jpeg"],w=["doc","docx"],b={2:{label:"图片",accept:k},3:{label:"word",accept:w}},x=n(600);n("");const _=n(!1),l=n({children:[],name:"",kind:""}),g=n({children:[],name:"",kind:""}),r=n({fileType:[],isFlat:0,isFileName:1}),S=n([{formType:"select",prop:"fileType",label:"文件类型:",teleported:!1,optionList:Object.entries(b).map(([e,t])=>({label:t.label,value:e}))},{formType:"switch",prop:"isFlat",label:"是否扁平化:",inactiveValue:0,activeValue:1},{formType:"switch",prop:"isFileName",label:"是否显示文件名称:",inactiveValue:0,activeValue:1}]),C=e=>{if(e.kind==="directory")return 1;if(e.kind==="file"){let t=e.name.split(".").pop(),i=e.name.split(".").pop();return k.includes(t)?2:w.includes(i)?3:-1}else return 0};let F=1;async function N(e){if(e.id=F,F++,e.type=C(e),e.kind==="file")return e.type===2&&(e.imageUrl=G(await e.getFile())),e;e.children=[];const t=e.entries();for await(const i of t)e.children.push(await N(i[1]));return e}const D=()=>{v.openModal("file-type-popup",{})},V=e=>{let t=[];for(const o of r.value.fileType)t=t.concat(b[o].accept);t=[...new Set(t)];let i=[];const s=o=>{if(r.value.isFlat&&o.kind==="file"&&i.push(o),o.kind==="directory"){o.children=o.children.filter(a=>{let R=a.name.split(".").pop();return a.kind==="directory"||t.length==0?!0:a.kind==="file"&&t.includes(R)});for(let a of o.children)a=s(a)}return o};let d=s(e);return r.value.isFlat&&(d.children=[{id:-1,name:"全部",kind:"directory",type:1,children:i}]),d},j=async()=>{const{protocol:e,hostname:t}=window.location;if(e==="http:"&&t!=="localhost"){H.error("http需要使用localhost访问");return}const i=await window.showDirectoryPicker();_.value=!0,v.closeModal("file-type-popup");const s=await N(i);g.value=V(s),_.value=!1},L=e=>{l.value=e},M=()=>{const e=document.getElementById("dirTreeBox"),{height:t}=e.getBoundingClientRect();x.value=t};return P(()=>{M()}),(e,t)=>{const i=p("el-tree-v2"),s=p("c-form"),d=p("c-dialog"),o=p("c-card");return c(),u(o,{isNone:"",isAffix:"",class:"wrap-page directory-picker"},{default:f(()=>[m("div",q,[y(A,{createBtnText:"读取文件",loading:_.value,onOnCreate:D},{header:f(()=>[]),default:f(()=>[m("div",z,[g.value.children.length?(c(),u(i,{key:0,ref:"treeRef",class:"dir-tree","node-key":"path","default-expand-all":"","check-on-click-node":"",height:x.value,"expand-on-click-node":!1,data:g.value.children,props:{value:"id",label:"name",children:"children"},onNodeClick:L},null,8,["height","data"])):h("",!0)])]),_:1},8,["loading"]),m("div",J,[m("div",K,U(l.value.name),1),l.value.type==1?(c(),B("div",X,[(c(!0),B(Q,null,W(l.value.children,a=>(c(),u(T,{key:a.name,item:a,isFileName:r.value.isFileName},null,8,["item","isFileName"]))),128))])):h("",!0),l.value.type>1?(c(),u(T,{item:l.value,key:l.value.name,isFileName:r.value.isFileName},null,8,["item","isFileName"])):h("",!0)])]),y(d,{title:"选择类型",width:600,"append-to-body":!1,name:"file-type-popup"},{default:f(()=>[y(s,{ref:"formRef","label-width":"150px",isDialog:"",model:r.value,rows:S.value,onSubmit:j},null,8,["model","rows"])]),_:1})]),_:1})}}}),de=E(Z,[["__scopeId","data-v-1af3057f"]]);export{de as default};
